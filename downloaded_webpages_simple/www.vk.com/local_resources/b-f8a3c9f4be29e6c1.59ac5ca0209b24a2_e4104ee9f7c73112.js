"use strict";(self.webpackChunkvkmvk=self.webpackChunkvkmvk||[]).push([[66429],{46641:function(t,e,n){n.d(e,{isModernCSSSupported:function(){return l},isTouch:function(){return c}});var r,s=n(12244);let o=window._ua;o||(o=navigator.userAgent.toLowerCase());const i=/android/i.test(o),a={version:(o.match(/.+(?:me|ox|on|rv|it|era|ie)[\/: ]([\d.]+)/)||[0,"0"])[1],amigo:/amigo.*mrchrome soc/i.test(o),opera:/opera/i.test(o),msie:/msie/i.test(o)&&!/opera/i.test(o),msie6:/msie 6/i.test(o)&&!/opera/i.test(o),msie7:/msie 7/i.test(o)&&!/opera/i.test(o),msie8:/msie 8/i.test(o)&&!/opera/i.test(o),msie9:/msie 9/i.test(o)&&!/opera/i.test(o),mozilla:/firefox/i.test(o),yabrowser:/yabrowser/i.test(o),chrome:/chrome/i.test(o)||/crios/i.test(o),safari:!/crios/i.test(o)&&!/chrome/i.test(o)&&/webkit|safari|khtml/i.test(o),iphone:/iphone/i.test(o),ipod:/ipod/i.test(o),iphone4:/iphone.*OS 4/i.test(o),ipod4:/ipod.*OS 4/i.test(o),ipad:/ipad/i.test(o),ios:+(o.match(/.+(?:ipod|ipad|iphone.*os) ([\d.]+)_/i)||[0,0])[1],android:i,android_version:i?String(null==(r=o.match(/android (\d+(?:\.\d+)*);/i))?void 0:r[1]):void 0,bada:/bada/i.test(o),opera_mini:/opera mini/i.test(o),uc_mini:/mobile safari.*ucbrowser/i.test(o),mobile:/iphone|ipod|ipad|opera mini|opera mobi|iemobile/i.test(o),msie_mobile:/iemobile/i.test(o),msie_edge:/edge/i.test(o)&&!/opera/i.test(o),safari_mobile:/iphone|ipod|ipad/i.test(o),opera_mobile:/opera mini|opera mobi/i.test(o),mac:/mac/i.test(o),mi:/miuibrowser/i.test(o),meizu:/MZBrowser/i.test(o)};a.desktop=(a.opera||a.msie||a.mozilla||a.chrome||a.safari)&&!a.mobile;var c="ontouchstart"in window,u=function(t){if("WebKitCSSMatrix"in t&&"m11"in new t.WebKitCSSMatrix)return!0;if("MSCSSMatrix"in t&&"m11"in new t.MSCSSMatrix)return!0;if("CSSMatrix"in t&&"m11"in new t.CSSMatrix)return!0;try{var e=ce("div"),n=getCssPropertyName(e,"transform");return!!n&&(e.style[n]="translate3d(1px,1px,1px)",e.style[n]&&"none"!=e.style[n])}catch(t){return!1}}(window);let d;function l(){return d||(d=(0,s.isFlexboxSupported)()&&(0,s.isCSSVariablesSupported)()&&(0,s.isMatchMediaSupported)()&&(0,s.isSVGSupported)()&&(0,s.isSupportsSupported)()&&(0,s.isGridsSupported)(),d)}e.default=a,Object.assign(window,{browser:a,_ua:o,mobPlatforms:{1:1,2:1,3:1,4:1,5:1},isTouch:c,has3d:u})},89114:function(t,e,n){function r(){const t=document.domain||"";if(["oauth.","api.","edu_m.",".vksak."].some((e=>t.includes(e))))return;const e=t.match(/(m\.)?([a-zA-Z]+\.[a-zA-Z]+\.?)$/);window.locDomain="https:"===location.protocol?e[2]:e[0];const n=navigator.userAgent.toLowerCase();!/opera/i.test(n)&&/msie 6/i.test(n)&&document.domain===window.locDomain||(document.domain=window.locDomain)}n.d(e,{setDocumentDomain:function(){return r}})},12244:function(t,e,n){function r(t=window.browser){return!(!t.mac||t.iphone||t.ipad||t.ipod||!(navigator.maxTouchPoints>1))}n.r(e),n.d(e,{isAutoSchemesSupported:function(){return u},isCSSVariablesSupported:function(){return i},isDarkTheme:function(){return s},isES2016supported:function(){return w},isES2017supported:function(){return v},isES2018supported:function(){return O},isES2019supported:function(){return I},isES2020supported:function(){return b},isES2021supported:function(){return y},isES2022supported:function(){return P},isES6supported:function(){return E},isFlexboxSupported:function(){return c},isGridsSupported:function(){return l},isIPadOS:function(){return r},isInstalledRelatedAppsSupported:function(){return k},isIntersectionObserverSupported:function(){return p},isJsModulesSupported:function(){return A},isLightTheme:function(){return o},isMatchMediaSupported:function(){return a},isMutationObserverSupported:function(){return S},isPreloadSupported:function(){return N},isResizeObserverSupported:function(){return g},isSVGSupported:function(){return _},isStickySupported:function(){return m},isSupportsSupported:function(){return d},isTelegramWebView:function(){return M},isWebAssemblySupported:function(){return D},isWebRTCCallsSupported:function(){return f},isWebpSupported:function(){return h}});const s=()=>Boolean(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches),o=()=>Boolean(window.matchMedia&&window.matchMedia("(prefers-color-scheme: light)").matches),i=()=>Boolean(window.CSS&&CSS.supports&&CSS.supports("color","var(--custom-property)")),a=()=>Boolean(window.matchMedia),c=()=>document.documentElement.classList.contains("vk_flex_yes"),u=()=>Boolean(window.matchMedia&&window.matchMedia("(prefers-color-scheme)").matches),d=()=>Boolean(window.CSS&&CSS.supports),l=()=>Boolean("string"==typeof document.createElement("div").style.grid),_=()=>Boolean(document.createElementNS)&&Boolean(document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect),h=t=>{const e=new Image;e.src="data:image/webp;base64,UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA==",e.onload=()=>{const n=e.width>0&&e.height>0;t(n)},e.onerror=()=>{t(!1)}},p=()=>"IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype,S=()=>"MutationObserver"in window,g=()=>"ResizeObserver"in window,m=()=>Boolean(CSS&&CSS.supports&&CSS.supports("position","sticky")),f=()=>{if(window.navigator.userAgent.indexOf("Edge")>-1)return!1;try{return Boolean(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&window.RTCPeerConnection&&window.RTCIceCandidate&&window.RTCSessionDescription)}catch(t){return!1}};const A=()=>!window.nomodules,E=()=>Boolean(window.Promise),w=()=>Boolean(Array.prototype.includes),v=()=>Boolean(String.prototype.padEnd),O=()=>Boolean(Promise.prototype.finally),I=()=>Boolean(Object.fromEntries),b=()=>Boolean(String.prototype.matchAll);let R=null;function y(){return R||(R=Boolean(String.prototype.replaceAll)&&function(){try{new Function("var v;v||=1")()}catch(t){return!1}return!0}()),R}const P=()=>Boolean(Object.hasOwn),k=()=>Boolean("getInstalledRelatedApps"in navigator);let T=null;const N=()=>{var t,e;null==T&&(T=Boolean(null==(e=document.createElement("link").relList)||null==(t=e.supports)?void 0:t.call(e,"preload")));return T},D=()=>{try{if("object"==typeof WebAssembly&&"function"==typeof WebAssembly.instantiate){const t=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(t instanceof WebAssembly.Module)return new WebAssembly.Instance(t)instanceof WebAssembly.Instance}}catch(t){}return!1},M=()=>{if(window.navigator.userAgent.indexOf("force_telegram_redirect")>-1)return!0;const t=window.TelegramWebview,e=window.TelegramWebviewProxy;return Boolean(t||e)}},23645:function(t,e,n){function r(t,e){return new Promise((n=>{setTimeout(n.bind(null,e),1e3*t)}))}function s(t,e,n=null){let s=0;return function o(...i){return Promise.resolve().then((()=>t(...i))).catch((t=>{if(s++,s<=e){const t="function"==typeof n?n(s):0;return 0===t?o(...i):r(t).then((()=>o(...i)))}throw t}))}}function o(t,e){let n;const r=new Promise((r=>{n=r,setTimeout(r.bind(null,e),1e3*t)}));return{pause:()=>r,abort(){n(e)}}}n.d(e,{abortablePause:function(){return o},pause:function(){return r},retryFn:function(){return s}})},72509:function(t,e,n){n.d(e,{isCSSPreloadEnabled:function(){return c},isModernCSS:function(){return a},isModernJS:function(){return i}});var r=n(46641),s=n(12244),o=n(45549);function i(){return void 0!==window.vk.static.js_stage?window.vk.static.js_stage>=1:!(0,o.partConfigEnabled)("mvk_force_fallback_js")&&(0,s.isES2021supported)()}function a(){return void 0!==window.vk.static.css_stage?window.vk.static.css_stage>=1:(0,r.isModernCSSSupported)()}const c=(0,s.isPreloadSupported)()&&(0,r.isModernCSSSupported)()},44749:function(t,e,n){n.d(e,{api:function(){return _},setApiConfig:function(){return h}});var r=n(57616),s=n(33373),o=n(3005),i=n(7713),a=n(58458),c=n(76905),u=n(45549),d=n(27145),l=n(9497);const _=(t,e,n,s={},c={})=>{if(!o.globalState.isApiInited)return Promise.reject(new Error("[VKJS][API]: api didn't init. Use setApiConfig function"));let _=null;(0,u.partConfigEnabled)("send_stack_trace_request_api_error")&&"groups.getById"===t&&(_=new Error("request api error"));const h=()=>((t,e,n,s={},i={})=>{if(!o.globalState.isAuth)return Promise.reject(new Error("[VKJS][API]: missing access_token"));const a=o.globalState.isAuth||(0,u.partConfigEnabled)("loginvk_api_use_anonymous_token")?e:{client_secret:r.clientSecret,...e};return(0,d.api)(t,a,n,s,i)})(t,e,n,s,c).then((t=>t),(t=>{var e;_&&((null==t||null==(e=t.error)?void 0:e.error_msg)&&(_.message=t.error.error_msg),(0,a.logError)(_,{breadcrumb:{data:t}}));throw t}));return o.globalState.didFirstLogin?h():(0,i.fetchToken)().then((t=>(o.globalState.didFirstLogin=!0,(0,l.setApiConfig)({accessToken:t.access_token}),h())))},h=t=>{var e;o.globalState.isApiInited?(0,l.setApiConfig)({...t}):((0,l.setApiConfig)({appId:(0,u.partConfigEnabled)("video_client_appid")?r.clientId:s.VK_WEB_APP_ID,version:s.API_VERSION,onTokenExpired:()=>(0,i.fetchToken)(!0).then((({access_token:t})=>t||"")),grouping:c.Ranges.isUserId(null==(e=window.vk)?void 0:e.id),formattedExecuteResponse:(0,u.partConfigEnabled)("vkid_api_formatted_execute_response"),...t}),o.globalState.isApiInited=!0)}},7713:function(t,e,n){n.d(e,{fetchToken:function(){return E},login:function(){return A},setLoginConfig:function(){return f}});var r=n(34653),s=n(37475);const o="deviceId",i=()=>{const t=(0,r.nanoid)();try{s.vkLocalStorage.setItem(o,t)}catch(t){console.error("[VKJS]: ",t)}return t},a=()=>{try{const t=s.vkLocalStorage.getItem(o);return t||i()}catch(t){return i()}};var c=n(57616),u=n(33373),d=n(3005),l=n(23645),_=n(45549),h=n(74227),p=n(5531),S=n(98733);let g,m;const f=t=>{d.globalState.isAuthInited||((0,S.setLoginConfig)({appId:u.VK_WEB_APP_ID,...t}),d.globalState.isAuthInited=!0,m=t.appId,g=t.useAPIGateWay)},A=(t,e,n,r,s={})=>{if(!d.globalState.isAuthInited)return Promise.reject(new Error("[VKJS][LOGIN]: login didn't init. Use setLoginConfig function"));let o;return o=(0,_.partConfigEnabled)("web_api_token_fetch_retry")?(0,l.retryFn)((()=>(0,S.login)(t,e,n,r,s)),2,(t=>{var e;return null!=(e=[.25,.5][t-1])?e:.5}))():(0,S.login)(t,e,n,r,s),o.then((t=>{var e;if(Boolean(t.access_token)&&(d.globalState.isAuth=!0),(null==(e=window.vk)?void 0:e.id)&&!d.globalState.isAuth&&console.error("[VKJS][LOGIN] Token request failed:",t),(0,_.partConfigEnabled)("act_a_check_after_web_token")&&Boolean(t.access_token))try{(0,S.login)("a_check",{access_token:t.access_token})}catch(t){console.error("[VKJS][LOGIN]: a_check act is failed")}return t})).catch((t=>{if(console.error("[VKJS][AUTH]:",t),"unauthorized"===t.error&&"login_error"===t.type){const t=(0,_.partConfigEnabled)("loginvk_unauthorized_force_logout");if(console.error(`[VKJS][AUTH]: logout ${t?"enabled":"disabled"} because `,"loginvk_unauthorized_force_logout = ",t),t)return(0,S.removeLoginCache)(),d.globalState.didFirstLogin=!0,d.globalState.isAuth=!1,(0,p.saveStatlogEvents)({name:"connect_logout_web_link",value:1,keys:[window.location.href]}),window.location.href=window.vk.logoutUrl,new Promise((()=>{}))}return{access_token:"",error:!0,...t}}))},E=(t=!1)=>{var e;const n="audio_anonymous,video_anonymous,photos_anonymous,profile_anonymous";if(g||(0,_.partConfigEnabled)("frontend.video_web_api_auth_token")&&(0,h.isVkVideo)()&&!(0,h.isMvkVKVideo)()){const e=((t,...e)=>{var n;if(null==(n=window.vk)?void 0:n.id)return window.vk.id;for(const n of e)try{const e=`${t}:${n}:login:auth`,r=s.vkLocalStorage.getItem(e);if(!r)continue;const{user_id:o}=JSON.parse(r);if(Number(o))return Number(o)}catch(t){console.error("[VKJS]: ",t)}return 0})(m||c.clientId,"video.getWebToken","web_token");return e<=0?A("video.getAnonymToken",{scopes:n,device_id:a()},{useAPIGateWay:!0},t):A("video.getWebToken",{},{useAPIGateWay:!0},t)}if((null==(e=window.vk)?void 0:e.id)<=0&&(0,_.partConfigEnabled)("loginvk_api_use_anonymous_token"))return A("get_anonym_token",{client_secret:c.clientSecret,client_id:c.clientId,scopes:n,isApiOauthAnonymEnabled:(0,_.partConfigEnabled)("video_fix_refresh_anonym_token")},{},t);if((0,_.partConfigEnabled)("video_embed_login")&&(0,h.isEmbed)()){const e=window.location.hostname.includes("vkvideo")?{appId:c.clientId,domain:window.location.hostname,path:"al_video.php"}:{};return A("web_token",{},e,t)}return!(0,h.isVkVideo)()||!(0,_.partConfigEnabled)("video_embed_login")&&(0,h.isEmbed)()?A("web_token",{},{},t):(0,h.isMvkVKVideo)()?A("web_token",{},{domain:window.location.hostname,path:"video",appId:c.clientId},t,{headers:{"X-Requested-With":"XMLHttpRequest","Content-Type":"application/x-www-form-urlencoded"}}):A("web_token",{},{appId:c.clientId,domain:window.location.hostname,path:"al_video.php"},t)}},57616:function(t,e,n){n.d(e,{API_VERSION:function(){return g},VK_MVK_APP_ID:function(){return l},VK_MVK_VKVIDEO_APP_ID:function(){return h},VK_WEB_APP_ID:function(){return d},VK_WEB_VKVIDEO_APP_ID:function(){return _},clientId:function(){return S},clientSecret:function(){return p}});var r=n(74227),s=n(45439);const o="aR5NKGmm03GYrCiNKsaw",i="QbYic1K3lEV5kTGiqlq2",a="IjjCNl4L4Tf5QZEXIHKK",c="o557NLIkAErNhakXrQ7A",u="WStp4ihWG4l3nmXZgIbC",d=6287487,l=7879029,_=52461373,h=52649896,{clientSecret:p,clientId:S}=(()=>{let t=d,e=i;return(0,r.isMvk)()&&(t=l,e=o),(0,r.isVkMe)()&&(t=51745158,e=a),(0,r.isVkVideo)()&&(t=_,e=c),(0,r.isMvkVKVideo)()&&(t=h,e=u),{clientId:t,clientSecret:e}})(),g=s.API_VERSION},3005:function(t,e,n){n.d(e,{globalState:function(){return r}});const r={isApiInited:!1,isAuthInited:!1,didFirstLogin:!1,isAuth:!1}},33373:function(t,e,n){n.d(e,{API_VERSION:function(){return r.API_VERSION},VK_MVK_APP_ID:function(){return r.VK_MVK_APP_ID},VK_MVK_VKVIDEO_APP_ID:function(){return r.VK_MVK_VKVIDEO_APP_ID},VK_WEB_APP_ID:function(){return r.VK_WEB_APP_ID},VK_WEB_VKVIDEO_APP_ID:function(){return r.VK_WEB_VKVIDEO_APP_ID},clientId:function(){return r.clientId},clientSecret:function(){return r.clientSecret}});n(44749),n(7713);var r=n(57616)},77790:function(t,e,n){n.d(e,{TaskQueue:function(){return o}});var r=n(58732),s=n.n(r);class o{get events(){return this._emitter}static migrate(t,e=()=>{}){const n=new o(e);return n.pause(),t&&t.destroy&&t._handlers&&t._q&&(t.destroy(),Object.keys(t._handlers).forEach((e=>{const r=t._handlers[e];n.setHandler(e,r,r.once)})),t._q.forEach((t=>n.push(t)))),n.restart(),n}setupGc(t){this._gcTimer&&clearInterval(this._gcTimer),this._gcTimer=setInterval(this._gcTask.bind(this),t||o._gcDefaultInterval)}_next(t=!1){this._timer=setTimeout(this._processNext.bind(this),t?0:this._timerInterval)}_gcTask(){this.pause(),this._emitter.emit("ev_gc_start");const t=this._q.filter((t=>t.postponed));this._q=this._q.filter((t=>!t.postponed)),this._emitter.emit("ev_gc_end",t),this.restart()}_processNext(){const[t]=this._q.splice(0,1);if(!t)return void this.pause();const e=this._handlers[t.selector];if((null==e?void 0:e.once)&&this.removeHandler(t.selector),!e)return t.postponed||(t.postponed=!0),this._q.push(t),void(this._timer&&this._next());let n;this._emitter.emit("ev_task_start",t.selector),window._tqVerbose&&console.info("Running evbus task",t.selector);try{n=Promise.resolve(e(t))}catch(t){n=Promise.reject(t)}n.then((()=>{this._next(!0)}),(e=>{this._errorHandler&&this._errorHandler(t,e),this._next(!0)}))}constructor(t=()=>{}){this._errorHandler=t,this._timerInterval=15,this._handlers=Object.create(null),this._emitter=new(s()),this._q=[],this.destroy=()=>{this.pause(),clearInterval(this._gcTimer)},this.pause=()=>{this._timer&&(clearTimeout(this._timer),this._timer=void 0,this._emitter.emit("ev_paused"))},this.restart=()=>{this._timer||(this._next(),this._emitter.emit("ev_restarted"))},this.push=t=>{this._q.push(t),this.restart()},this.setHandler=(t,e,n=!1)=>{e.once=n,this._handlers[t]=e,this._emitter.emit("ev_new_handler",t)},this.removeHandler=t=>{delete this._handlers[t],this._emitter.emit("ev_rm_handler",t)},this._next()}}o._gcDefaultInterval=5e3},92294:function(t,e,n){n.d(e,{init:function(){return r.init},tq:function(){return r.tq}});var r=n(62964);n(43445)},62964:function(t,e,n){n.d(e,{init:function(){return c},isTQInitialized:function(){return a},tq:function(){return u}});var r=n(77790),s=n(56320),o=n(45549),i=n(43445);const a=()=>!!(0,i.containerNode)()._tq,c=(t=s.onDomReady)=>{if((0,o.partConfigEnabled)("lazy_tq_init"))return;const e=(0,i.containerNode)();a()?(e._tqi=r.TaskQueue.migrate(e._tqi,i.tqErrorHandler),e._tqs=r.TaskQueue.migrate(e._tqs,i.tqErrorHandler),(0,i.refreshHandlers)(t)):(0,i.initTq)(t)},u=(0,i.tqgen)("tq")},43445:function(t,e,n){n.d(e,{containerNode:function(){return l},initTq:function(){return E},refreshHandlers:function(){return A},tqErrorHandler:function(){return d},tqgen:function(){return _}});var r=n(42568),s=n(45549),o=n(77790),i=n(56320),a=n(58458);const c={click:1,mouseover:1,mouseout:1,keyup:1,keydown:1,change:1,paste:1},u=["focus","mouseenter","mouseleave"],d=(t,e)=>{const n={message:"Task execution error",data:{taskName:t.selector,type:void 0===t.payload.dataAttrs?"startup_task":"interactive_task",params:JSON.stringify(void 0===t.payload.dataAttrs?t.payload.data:t.payload.dataAttrs)}};(0,a.logError)(e,{environment:"task_queue",breadcrumb:n}),console.error(e)},l=()=>{if(!document.head)throw new Error("Document must be loaded before queue init");return document.head},_=t=>()=>{const e=l();if((0,s.partConfigEnabled)("lazy_tq_init")&&(e._tq||E(i.onDomReady)),!e["_"+t])throw new Error(t+" not initialized");return e["_"+t]},h=_("tqi"),p=_("tqs"),S=t=>e=>{if(e.type!==t||!e.target||!t)return;let n=(t=>{return t.nodeType===Node.TEXT_NODE?t.parentNode:(0,s.partConfigEnabled)("web_task_queue_global_handler_init_svg_fix")?"svg"===t.nodeName?t.parentNode:"path"===t.nodeName?null==(e=t.parentNode)?void 0:e.parentNode:t:t;var e})(e.target);if((0,r.isReactHTMLElement)(n)||!n.dataset)return;let o=n.dataset[`task${t.toUpperCase()[0]+t.slice(1)}`];if(!o){if("click"!==e.type)return;const r=n.closest("[data-task-click]");if(!r)return;n=r,o=r.dataset[`task${t.toUpperCase()[0]+t.slice(1)}`]}if(o){if(n.dataset.prevent&&e instanceof MouseEvent&&"A"===n.tagName){const t=n.hasAttribute("href"),r=e.ctrlKey||e.metaKey;if(t&&r)return}if(h().push({selector:o,payload:{target:n,dataAttrs:n.dataset,event:e},postponed:!1,createTime:Date.now()}),n.dataset.prevent)return 2&Number(n.dataset.prevent)&&e.stopPropagation(),e.preventDefault(),!1}},g=t=>{if(t.matches("[data-exec]")){const e=t.dataset.exec||"{}";t.removeAttribute("data-exec"),((t,e)=>{let n={};try{n=JSON.parse(t)}catch(e){console.error("Failed to parse JSON: ",t)}for(let t in n)n.hasOwnProperty(t)&&p().push({selector:t,payload:{target:e,data:n[t]},postponed:!1,createTime:Date.now()})})(e,t)}},m=t=>{for(const n of u){const r=`data-task-${n}`;if(t.hasAttribute(r)){var e;const s=null!=(e=t.getAttribute(r))?e:"";t.removeAttribute(r),t.addEventListener(n,(e=>{const n=h()._handlers[s];Promise.resolve(null).then((()=>null==n?void 0:n({selector:s,payload:{dataAttrs:t.dataset,target:t,event:e},postponed:!1,createTime:Date.now()}))).catch((t=>console.error(t)))}),{passive:!0})}}},f=(t=document)=>{for(const e of t.querySelectorAll("[data-exec]"))(e instanceof HTMLElement||e instanceof SVGElement)&&g(e);for(const e of u)for(const n of t.querySelectorAll(`[data-task-${e}]`))(n instanceof HTMLElement||n instanceof SVGElement)&&m(n)},A=t=>t((()=>{((t,e)=>{for(let n in e)e.hasOwnProperty(n)&&t.removeEventListener(n,e[n])})(document.body,l()._tqhl),l()._tqhl=(t=>{const e={};for(let n in c){if(!c.hasOwnProperty(n))continue;const r=S(n);t.addEventListener(n,r),e[n]=r}return e})(document.body)})),E=t=>{const e=l();e._tqs=new o.TaskQueue(d),e._tqi=new o.TaskQueue(d),A(t),e._tq={setInteractiveHandler:(t,n,r=!1)=>e._tqi.setHandler(t,n,r),setStartupHandler:(n,r,s=!1)=>{e._tqs.setHandler(n,r,s),t((()=>{e._tqs.setupGc(),e._tqs.restart()}))}},t((()=>{e._tqi.setupGc(),window._obs=new MutationObserver((function(t){for(let e of t)for(let t of e.addedNodes)(t instanceof HTMLElement||t instanceof SVGElement)&&(g(t),m(t),f(t))})),window._obs.observe(document,{subtree:!0,childList:!0,attributes:!0}),f(document)}))}},74859:function(t,e,n){n.d(e,{resolveDeviceId:function(){return i},resolveDeviceIdWithUseragent:function(){return c}});var r=n(39369);function s(){return Promise.all([n.e(61037),n.e("langs/mvk/grip-lib")]).then(n.bind(n,63756))}let o=null;async function i(){if(o)return o;try{const{initGrip:t}=await s();o=await t()}catch(t){o="empty"}return o}let a=null;function c(){return a?Promise.resolve(a):new Promise((async t=>{const{Grip:e}=await s(),n="remixmvk-fp";try{(new e).get((e=>{(0,r.getCookie)(n)!==e&&(0,r.setCookie)(n,e,7,1),a=e,t(e)}))}catch(e){t("empty")}}))}},18571:function(t,e,n){n.d(e,{CSS_LOAD_ERROR_TEXT:function(){return i},JS_LOAD_ERROR_TEXT:function(){return d},loadScript:function(){return l},loadStyle:function(){return u}});var r=n(58458),s=n(45549),o=n(74227);const i="Stylesheet load error for",a=t=>!!t&&/st\d+-\d+/.test(t)?(0,s.partConfigEnabled)("crossorigin_credentials_regions"):(0,s.partConfigEnabled)("crossorigin_credentials_spb");function c(t){var e,n;const r=(0,o.isMvk)()?null==(e=window.vk)?void 0:e.static.domain:null==(n=window.vk)?void 0:n.stDomain;return!(!r||!a(r))&&t.includes(r)}function u(t,{preload:e,target:n=document.head,fetchPriority:o}={}){if((0,s.partConfigEnabled)("log_static_duplicates_errors")&&n instanceof HTMLElement){Array.from(n.getElementsByTagName("link")).filter((t=>"text/css"===t.type)).filter((e=>{var n;return null==(n=e.href)?void 0:n.endsWith(t)})).length>0&&(0,r.logError)(new Error("Loading duplicate style with src "+t))}return new Promise(((r,a)=>{const u=document.createElement("link");e?(u.rel="preload",u.as="style"):u.rel="stylesheet",(0,s.partConfigEnabled)("fetch_priority_experiment")&&o&&(u.fetchPriority=o),u.type="text/css",u.href=t,c(t)&&(u.crossOrigin="use-credentials"),u.onload=()=>{r([t,u])},u.onerror=(e,n,r,o,c)=>{u.remove(),a((0,s.partConfigEnabled)("extended_static_loading_errors")?{message:n?String(e):`${i} ${t}`,source:null!=n?n:t,lineno:r,colno:o,error:c}:new Error(`${i} ${t}`))},n.appendChild(u)}))}const d="Script load error for";function l(t,e=document.head,n){if((0,s.partConfigEnabled)("log_static_duplicates_errors")){const n=e instanceof Element?e:document.head;Array.from(n.getElementsByTagName("script")).filter((e=>{var n;return null==(n=e.src)?void 0:n.endsWith(t)})).length>0&&(0,r.logError)(new Error("Loading duplicate script with src "+t))}return new Promise(((r,o)=>{let i=document.createElement("script");if(i.src=t,c(t)&&(i.crossOrigin="use-credentials"),i.onload=()=>r([t,i]),i.onerror=(e,n,r,a,c)=>{i.remove(),o((0,s.partConfigEnabled)("extended_static_loading_errors")?{message:n?String(e):`${d} ${t}`,source:null!=n?n:t,lineno:r,colno:a,error:c}:new Error(`${d} ${t}`))},n)for(const[t,e]of Object.entries(n))null==e||("boolean"==typeof e?i.toggleAttribute(t,e):i.setAttribute(t,e));e.appendChild(i)}))}},5531:function(t,e,n){n.d(e,{getWebStatsInitParams:function(){return g},saveBenchmarkMainStats:function(){return k},saveCustomStats:function(){return O},saveNetworkStats:function(){return v},saveProductionStats:function(){return I},saveStatlogEvents:function(){return w},saveStoryViewBaseStats:function(){return R},saveStoryViewStats:function(){return y},saveVkResStats:function(){return N},saveWebPerfStats:function(){return P},sendWebStats:function(){return T},writeAndSendWebStats:function(){return b}});var r=n(64830),s=n(59197),o=n(51479),i=n(33373),a=n(74227),c=n(74859),u=n(45549),d=n(80161);const l=()=>({get st(){return window.vk.statsMeta.st},get platform(){var t,e,n,r;return(null==(e=window.vk)||null==(t=e.statsMeta)?void 0:t.platform)?null==(r=window.vk)||null==(n=r.statsMeta)?void 0:n.platform:(0,a.isMvk)()?"mvk":"web2"},get appId(){return(0,u.partConfigEnabled)("video_webstats_appid")?i.clientId:void 0},get time(){return window.vk.statsMeta.time},get hash(){return window.vk.statsMeta.hash},get wsTransport(){return window.vk.wsTransport},get userId(){return window.vk.id},get started(){return window.vk.started},get itemId(){var t;return null==(t=window.cur)?void 0:t.item_id},get itemOwnerId(){var t;return null==(t=window.cur)?void 0:t.item_owner_id},get itemType(){var t;return null==(t=window.cur)?void 0:t.item_type}}),_=()=>({get isDebuggerMode(){return(0,u.partConfigEnabled)("web_stats_transport_debugger")},get isNewQueue(){return(0,u.partConfigEnabled)("webinf_change_queue_analytics")},get useReservedUrls(){return(0,u.partConfigEnabled)("frontend.use_reserve_stats_url")}});function h(t,e){return`${t.wsTransport}/web-stats/${t.st?"s":"p"}${e&&`?${e}`}`}function*p(){var t,e;for(const n of null!=(e=null==(t=window.vk)?void 0:t.reservedTransport)?e:[])yield n}function S(){const t=(0,u.getConfigValue)("akashi_endpoint");return String(t)}const g=()=>({hostName:(0,a.getHostName)(),options:_(),statlogsValueEvent:d.statlogsValueEvent,getBrowserFingerprint:c.resolveDeviceId,statsMeta:l(),smallerChunks:!1,createUrl:h,generateReservedUrl:p}),m=(0,r.makeSharedState)("webStats",(()=>new s.WebStats(g())),{version:1}),f=(0,r.makeSharedState)("akashi",(()=>{const t={hostName:(0,a.getHostName)(),options:_(),localStorage:new o.CustomStorage,sessionStorage:new o.CustomStorage,getBrowserFingerprint:c.resolveDeviceId,statsMeta:l(),smallerChunks:!1,createUrl:S};return new s.WebStats(t)}),{version:1}),A=m(),E=f(),w=A.saveStatlogEvents.bind(A),v=A.saveNetworkStats.bind(A),O=A.saveCustomStats.bind(A),I=A.saveProductionStats.bind(A),b=A.writeAndSendWebStats.bind(A),R=A.saveStoryViewBaseStats.bind(A),y=A.saveStoryViewStats.bind(A),P=A.saveWebPerfStats.bind(A),k=A.saveBenchmarkMainStats.bind(A),T=A.sendWebStats.bind(A),N=E.saveVkResStats.bind(E)},76905:function(t,e,n){n.d(e,{Ranges:function(){return r.Ranges}});n(58458),n(45549);var r=n(40239)},42568:function(t,e,n){function r(t){return Object.keys(t).some((t=>t.startsWith("_react")||t.startsWith("__react")))}n.d(e,{isReactHTMLElement:function(){return r}})},56320:function(t,e,n){n.d(e,{onDomReady:function(){return r}});const r=t=>{"loading"!==window.document.readyState?t():window.document.addEventListener("DOMContentLoaded",(()=>t()),{once:!0})};new Promise((t=>{r(t)}))},59487:function(t,e,n){n.d(e,{API_ERROR_APP_AUTH:function(){return a},API_ERROR_AUTH:function(){return r},API_ERROR_AUTH_ANONYMOUS_TOKEN_HAS_EXPIRED:function(){return u},API_ERROR_CAPTCHA:function(){return i},API_ERROR_CUA_2_CONFIRMATION_REQUIRED:function(){return d},API_ERROR_FLOOD:function(){return o},API_ERROR_RATE_LIMIT:function(){return c},API_ERROR_TOO_MANY:function(){return s}});const r=5,s=6,o=9,i=14,a=28,c=29,u=1114,d=11500},12330:function(t,e,n){n.d(e,{PendingTask:function(){return r}});class r{constructor(){this.get=()=>this.promise,this.resolve=t=>this.resolveHandler(t),this.reject=t=>this.rejectHandler(t),this.promise=new Promise(((t,e)=>{this.resolveHandler=t,this.rejectHandler=e}))}}},27598:function(t,e,n){n.d(e,{Retries:function(){return s}});class r{constructor(t=1/0){this.tries=0,this.increment=()=>{this.tries++},this.get=()=>this.tries,this.isExceeded=()=>this.tries>=this.maxTries,this.maxTries=t}}class s{constructor(){this.retries=new Map,this.get=t=>this.retries.get(t),this.create=(t,e)=>(this.retries.set(t,new r(e)),this.retries.get(t)),this.delete=t=>{this.retries.delete(t)}}}},9497:function(t,e,n){n.d(e,{getApiConfig:function(){return s},setApiConfig:function(){return o}});let r={domain:"api.vk.com",maxRetries:10,grouping:!0};function s(){return r}function o(t){t=Object.assign({},r,t),r=t}},27145:function(t,e,n){n.d(e,{api:function(){return I},apiBeacon:function(){return T},upload:function(){return k}});var r=n(97802),s=n(59487),o=n(12330),i=n(14123);class a{setAccessToken(t){this.bodyParams.access_token=t}setGrouping(t){this.grouping=t}setParams(t){this.methodParams=t}canGroupInExecute(){return!this.method.includes("execute")&&(!!this.apiConfig.accessToken&&(!this.methodParams.v&&(!1!==this.grouping&&(void 0===this.fetchOptions.method&&(void 0===this.fetchOptions.headers&&void 0===this.fetchOptions.signal)))))}toString(){const t={};return"object"==typeof this.methodParams&&Object.keys(this.methodParams).forEach((e=>{const n=this.methodParams[e];null!=n&&(t[e]="object"==typeof n?String(n):n)})),`API.${this.method}(${JSON.stringify(t)})`}constructor(t,e,n={},r={},s={}){this.resolve=()=>{},this.reject=()=>{},this.method=t,this.methodParams=e,this.fetchOptions=s,this.overrideApiConfig=r,this.apiConfig=Object.assign({},n,r),this.grouping=this.apiConfig.grouping,this.queryParams=(0,i.getApiQueryParams)(this.apiConfig),this.apiConfig.captureAsyncStacktrace&&(this.asyncBaseError=new Error("Async error"));const o=(0,i.getApiBodyParams)(this.apiConfig);this.bodyParams=Object.assign({},e,o),this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}var c=n(27598),u=n(33740),d=n(85637),l=n(95748),_=n(10862),h=n(9497);const p=new c.Retries,S=new c.Retries;let g=null,m=null,f=null;const A=25,E=Math.floor(.2*A),w=new Map,v=[],O=[];function I(t,e,n={},s={},o={}){var i,c;const u=(null==(c=window)||null==(i=c.vk)?void 0:i.pe["frontend.web_statlogs_transport"])?R:b,d=new a(t,e,(0,h.getApiConfig)(),n,s);if(d.apiConfig.adhoc&&u===R){d.canGroupInExecute()||console.warn("adhoc tasks must be groupable");const t=window.setTimeout((()=>{u(v,n,s,d.apiConfig.enableForks)}),d.apiConfig.adhoc.timeout);return w.set(d,t),O.push(d),d.promise}if(d.canGroupInExecute()){var l,_;if((null==(_=window)||null==(l=_.vk)?void 0:l.pe["frontend.add_stack_to_groups_join_api"])&&"groups.join"===t){var p,S;const t=new Error("Call api.groups.join in execute: "+(null!=(S=null==o?void 0:o.source)?S:""));null==(p=(0,r.getClient)())||p.captureException(t)}v.push(d),f&&window.clearTimeout(f),f=window.setTimeout((()=>{u(v,n,s,d.apiConfig.enableForks)}),0)}else d.setGrouping(!1),P(d);return d.promise}async function b(t,e,n={},r){if(1===t.length){const e=t.shift();P(e),e.setGrouping(!1)}else{const s=[],o=[],c=[];for(let e=0;e<t.length;e+=1){if(!t[e].canGroupInExecute())continue;const n=t.splice(e,1)[0];if(e-=1,s.push(n),r&&0!==t.length&&(o.push(`'${n.method}': fork(${n})`),c.push(`wait(forks['${n.method}'])`)),s.length>=25)break}let u=`return [${s.join(",")}];`;if(r){const t=s[s.length-1];u=`\n        var forks = { ${o.join(",")} };\n\n        return [${c.join(",")},${t}];\n      `}const d=new a("execute",{code:u},(0,h.getApiConfig)(),e,n);d.setGrouping(!0),P(d);try{const t=await d.promise;let e=0;t.response.forEach(((n,r)=>{!1===n?((0,i.rejectWithApiError)(s[r],{type:_.APIErrorType.API_ERROR,error:t.execute_errors[e]}),e+=1):s[r].resolve(n)}))}catch(t){s.forEach((e=>(0,i.rejectWithApiError)(e,t)))}}t.length>0&&window.setTimeout((()=>b(t,e,n,r)),1e3)}async function R(t,e,n={},r){if(1===t.length&&0===O.length){const e=t.shift();P(e),e.setGrouping(!1)}else{const s=[],o=[];let c=A;const u=[],d=[];for(let e=0;e<O.length&&!(u.length>=E);e+=1){if(!O[e].canGroupInExecute())continue;const n=O.splice(e,1)[0];e-=1,c-=1,clearTimeout(w.get(n)),w.delete(n),u.push(n),r&&0!==t.length&&(s.push(`'${n.method}': fork(${n})`),o.push(`wait(forks['${n.method}'])`))}for(let e=0;e<t.length&&0!==c;e+=1){if(!t[e].canGroupInExecute())continue;const n=t.splice(e,1)[0];e-=1,c-=1,d.push(n),r&&0!==t.length&&(s.push(`'${n.method}': fork(${n})`),o.push(`wait(forks['${n.method}'])`))}const l=[...d,...u];let p=`return [${l.join(",")}];`;if(r){const t=l[l.length-1];p=`\n        var forks = { ${s.join(",")} };\n\n        return [${o.join(",")},${t}];\n      `}const S=new a("execute",{code:p},(0,h.getApiConfig)(),e,n);S.setGrouping(!0),P(S);try{const t=await S.promise;let e=0;t.response.forEach(((n,r)=>{!1===n?((0,i.rejectWithApiError)(l[r],{type:_.APIErrorType.API_ERROR,error:t.execute_errors[e]}),e+=1):l[r].resolve(n)}))}catch(t){l.forEach((e=>(0,i.rejectWithApiError)(e,t)))}}t.length>0&&window.setTimeout((()=>{R(t,e,n,r)}),1e3)}function y(t){try{var e;return null==(e=window.localStorage)?void 0:e.getItem(t)}catch(t){return null}}async function P(t){const e=t.methodParams.captcha_sid,n=t.methodParams.session;(g&&g.sid!==e||m&&m.session!==n)&&(0,i.rejectWithApiError)(t,{type:_.APIErrorType.API_ERROR,error:{error_code:0,error_msg:"Ddos limit exceeded",error_text:"Ddos limit exceeded"}});const{domain:r,formattedExecuteResponse:a}=t.apiConfig,c=(0,u.makeParams)(t.queryParams),f=`https://${r}/method/${t.method}?${c}`,A=Object.assign({[d.CUA_STATE_PARAM]:(y(d.STORAGE_CUA_STATE)||"").trim()||void 0,[d.CUA_SESSION_PARAM]:n||void 0},t.methodParams,t.bodyParams),E=(0,i.getRequestHash)(f,t.methodParams),w=S.get(E)||S.create(E,t.apiConfig.maxRetries),v=p.get(E)||p.create(E,t.apiConfig.maxRetries);try{await(0,l.waitTimeExp)(w.get()||v.get());const r=await(0,u.corsRequest)(f,A,t.fetchOptions);if(null==t.apiConfig.challenge?void 0:t.apiConfig.challenge.call(t.apiConfig,r))return void setTimeout((()=>{(0,i.rejectWithApiError)(t,{type:_.APIErrorType.API_ERROR,error:{error_code:0,error_msg:"Unknown",error_text:"Unknown"}})}),1e4);const c=await r.json();if(void 0!==c.response){var O,I;if(S.delete(E),p.delete(E),g&&g.sid===e)null==(O=g.task)||O.resolve(void 0),g=null,null==t.apiConfig.onCaptchaSuccess||t.apiConfig.onCaptchaSuccess.call(t.apiConfig);if(m&&m.session===n)null==(I=m.task)||I.resolve(void 0),m=null,null==t.apiConfig.onCuaSuccess||t.apiConfig.onCuaSuccess.call(t.apiConfig);return c.execute_errors?void(a||t.grouping?t.resolve({response:c.response||[],execute_errors:c.execute_errors}):t.resolve({...c.response,execute_errors:c.execute_errors})):void(t.grouping?t.resolve({response:c.response}):t.resolve(c.response))}const d=c.error;if(!d)return void(0,i.rejectWithApiError)(t,{type:_.APIErrorType.API_ERROR,error:{error_code:0,error_msg:"Unknown",error_text:"Unknown"}});if(t.apiConfig.onCaptcha&&(null==d?void 0:d.error_code)===s.API_ERROR_CAPTCHA)return void async function(t,e,n){if(!e.apiConfig.onCaptcha)return;const{captcha_sid:r,captcha_img:s,captcha_height:i,captcha_width:a,captcha_attempt:c,captcha_ts:u,is_refresh_enabled:d,is_sound_captcha_available:l,captcha_track:h,is_enabled_vkui:p,uiux_changes:S,redirect_uri:m}=t;if(g){if(g.sid!==n)return await g.task.get(),void await P(e);{const t=new o.PendingTask;t.get().then(g.task.resolve).catch(g.task.reject),g={sid:r,task:t}}}else g={sid:r,task:new o.PendingTask};try{const t=await e.apiConfig.onCaptcha({captcha_sid:r,captcha_img:s,captcha_height:i,captcha_width:a,is_refresh_enabled:d,is_sound_captcha_available:l,captcha_track:h,is_enabled_vkui:p,uiux_changes:S,redirect_uri:m}),n={captcha_ts:u,captcha_attempt:c},o=Object.assign({},e.methodParams,t,n);e.setParams(o),P(e)}catch(t){g=null,e.reject({type:_.APIErrorType.API_ERROR,error:t})}}(d,t,e);var b,R;if(g&&g.sid===e)null==(b=g.task)||b.resolve(void 0),g=null,null==t.apiConfig.onCaptchaSuccess||t.apiConfig.onCaptchaSuccess.call(t.apiConfig);if(t.apiConfig.onCua&&(null==d?void 0:d.error_code)===s.API_ERROR_CUA_2_CONFIRMATION_REQUIRED)return void async function(t,e){if(!e.apiConfig.onCua)return;const{cua_session:n}=t;if(m){if(m.session!==n)return await m.task.get(),void await P(e);{const t=new o.PendingTask;t.get().then(m.task.resolve).catch(m.task.reject),m={session:n,task:t}}}else m={session:n,task:new o.PendingTask};try{const t=await e.apiConfig.onCua({cua_session:n}),r=Object.assign({},e.methodParams,t);e.setParams(r),P(e)}catch(t){m=null,e.reject({type:_.APIErrorType.CUA_ERROR,error:t})}}(d,t);if(m&&m.session===e)null==(R=m.task)||R.resolve(void 0),m=null,null==t.apiConfig.onCuaSuccess||t.apiConfig.onCuaSuccess.call(t.apiConfig);if(0===t.apiConfig.maxRetries)return void(0,i.rejectWithApiError)(t,{type:_.APIErrorType.API_ERROR,error:d});if(w.isExceeded()||v.isExceeded())return S.delete(E),p.delete(E),void(0,i.rejectWithApiError)(t,{type:_.APIErrorType.API_ERROR,error:{error_code:d.error_code,error_msg:"Maximum of api retries exceeded",error_text:d.error_text}});if((0,i.isNotAllowedToMakeMoreRequests)(d.error_code))return v.increment(),S.delete(E),void P(t);if(p.delete(E),t.apiConfig.onTokenExpired&&function(t,e){var n;const{error_code:r,error_msg:o}=t;return!((null==(n=e.overrideApiConfig)?void 0:n.accessToken)||r!==s.API_ERROR_AUTH_ANONYMOUS_TOKEN_HAS_EXPIRED&&(r!==s.API_ERROR_AUTH&&r!==s.API_ERROR_APP_AUTH||o.endsWith("method is unavailable with service token.")||o.endsWith("method is unavailable with anonymous token.")))}(d,t)){const e=await t.apiConfig.onTokenExpired();return w.increment(),(0,h.setApiConfig)({accessToken:e}),t.setAccessToken(e),void P(t)}S.delete(E),(0,i.rejectWithApiError)(t,{type:_.APIErrorType.API_ERROR,error:c.error})}catch(n){g&&g.sid===e&&(g=null,null==t.apiConfig.onCaptchaSuccess||t.apiConfig.onCaptchaSuccess.call(t.apiConfig)),t.reject({type:_.APIErrorType.NETWORK_ERROR,error:n})}}async function k(t,e){return(await fetch(t,{method:"POST",body:e,mode:"cors"})).json()}function T(t,e,n){const r=new a(t,e,(0,h.getApiConfig)(),n),{domain:s}=r.apiConfig,o=(0,u.makeParams)(r.queryParams),i=`https://${s}/method/${r.method}?${o}`,c=Object.assign({},r.methodParams,r.bodyParams);return navigator.sendBeacon(i,(0,u.toFormData)(c))}},10862:function(t,e,n){n.d(e,{APIErrorType:function(){return r}});var r=function(t){return t.API_ERROR="api_error",t.NETWORK_ERROR="network_error",t.CUA_ERROR="cua_error",t}({})},14123:function(t,e,n){n.d(e,{getApiBodyParams:function(){return i},getApiQueryParams:function(){return o},getRequestHash:function(){return a},isNotAllowedToMakeMoreRequests:function(){return c},rejectWithApiError:function(){return u}});var r=n(59487),s=n(33740);const o=t=>{const e={v:t.version||"5.131"};return t.appId&&(e.client_id=t.appId),e},i=t=>({access_token:t.accessToken}),a=(t,e={})=>`${t}-${(0,s.makeParams)(Object.assign({},e))}`,c=t=>t===r.API_ERROR_RATE_LIMIT||t===r.API_ERROR_FLOOD||t===r.API_ERROR_TOO_MANY,u=(t,e)=>{if(!t.apiConfig.throwFullErrors)return void t.reject(e);const n=new Error("Api request failed",t.asyncBaseError?{cause:t.asyncBaseError}:void 0);Object.entries(e).forEach((([t,e])=>{n[t]=e})),t.reject(n)}},85637:function(t,e,n){n.d(e,{CUA_SESSION_PARAM:function(){return o},CUA_STATE_PARAM:function(){return s},STORAGE_CUA_STATE:function(){return r}});const r="cua_state",s="cua_state",o="cua_session"},98733:function(t,e,n){n.d(e,{login:function(){return R},removeLoginCache:function(){return y},setLoginConfig:function(){return v}});var r=n(12330),s=n(27598);class o{}o.setItemToStorage=(t,e)=>{try{localStorage.setItem(t,e)}catch(t){}},o.getItemFromStorage=t=>{try{return localStorage.getItem(t)}catch(t){}},o.removeItemFromStorage=t=>{try{localStorage.removeItem(t)}catch(t){}};var i=n(33740),a=n(95748);const c=/\d+:[a-zA-Z_]+:login:auth/,u="check result failure";var d=n(59487),l=n(9497),_=n(14123);const h=t=>{if(t.useAPIGateWay){return{app_id:(0,l.getApiConfig)().appId}}return{version:t.version||"1",app_id:t.appId}},p=t=>new Promise((e=>{null===o.getItemFromStorage(t)?(o.setItemToStorage(t,"1"),e()):setTimeout(e,(0,a.getRandomWaitTime)())})),S=t=>{let e=o.getItemFromStorage(t),n={};if(e)try{n=JSON.parse(e)}catch(t){}return n},g=t=>1e3*t-Date.now()>=a.ONE_MINUTE_MS,m=t=>{let e;const{error_code:n,error_msg:r}=t.error;switch(n){case d.API_ERROR_CAPTCHA:const{captcha_sid:s,captcha_img:o,captcha_width:i,captcha_height:a,captcha_attempt:c,captcha_ts:l,is_refresh_enabled:_,is_sound_captcha_available:h,captcha_track:p,is_enabled_vkui:S,uiux_changes:g,redirect_uri:m}=t.error;e={type:"captcha",captcha_type:"regular",captcha_sid:s,captcha_img:o,captcha_track:p,captcha_height:a,captcha_width:i,captcha_attempt:c,captcha_ts:l,is_refresh_enabled:_,is_sound_captcha_available:h,is_enabled_vkui:S,uiux_changes:g,redirect_uri:m};break;case d.API_ERROR_TOO_MANY:e={type:"error",error_info:u,error_code:String(n)};break;default:e={type:"error",error_info:r,error_code:String(n)}}return e},f=(t,{apiDomain:e,domain:n,path:r="",useAPIGateWay:s},o)=>{if(o)return`https://${e}/get_anonym_token`;if(s){const e=(0,l.getApiConfig)(),n=(0,i.makeParams)((0,_.getApiQueryParams)(e));return`https://${e.domain}/method/${t}?${n}`}return`https://${n}/${r}?act=${t}`},A=(t,{useAPIGateWay:e},n)=>{return e?(({response:t})=>({type:"okay",data:{...t,access_token:t.token}}))(t):n?"error"in(r=t)?{type:"error",error_code:r.error,error_info:r.error_description}:{type:"okay",data:{access_token:r.token,expires:r.expired_at}}:(t=>{if(!Array.isArray(t))return t;const[e]=t;return{type:"okay",data:e}})(t);var r},E=new s.Retries;let w={domain:"login.vk.com",apiDomain:"oauth.vk.com",maxRetries:3};function v(t){t=Object.assign({},w,t),w=t}const O=new Map,I=new Map;let b=!1;function R(t,e,n={},s=!1,c={}){const d=Object.assign({},w,n),l=`${d.appId}:${t}:login:auth`,_=`${l}--request`;let v=O.get(_);if(v)return v.get();const P=E.get(_)||E.create(_,d.maxRetries);return v=new r.PendingTask,O.set(_,v),(async()=>{await p(_),await(0,a.waitTimeExp)(P.get());const r=!I.get(_)||s;let w;d.disableSaveToken||(w=S(l));const k=e&&"isApiOauthAnonymEnabled"in e&&e.isApiOauthAnonymEnabled&&"get_anonym_token"===t;if(k&&(null==w?void 0:w.access_token)&&(null==w?void 0:w.expires)&&g(Number(w.expires)))return void v.resolve(w);if(!r&&(null==w?void 0:w.expires)&&g(Number(w.expires)))return o.removeItemFromStorage(_),O.delete(_),void v.resolve(w);const{onCaptcha:T,useAPIGateWay:N}=d,D={};(null==w?void 0:w.access_token)&&(N?D.token=w.access_token:D.access_token=w.access_token);const M=f(t,d,k),U=h(d),C=Object.assign({},e,U,D);y(t,n);try{const r=await(0,i.corsRequest)(M,C,c),s=await r.json();let a=A(s,d,k);var W;if("error"in a&&(a=m(a)),"error"===a.type)return O.delete(_),a.error_info===u?P.isExceeded()?(E.delete(_),v.reject({type:"login_error",error:{error_code:0,error_msg:"Maximum of login retries exceeded"}})):(P.increment(),void(async()=>{try{const r=await R(t,e,n);v.resolve(r)}catch(t){v.reject(t)}})()):(E.delete(_),void v.reject({type:"login_error",error:a.error_info,errorCode:null!=(W=a.error_code)?W:"unknown_error"}));if(E.delete(_),"captcha"===a.type){if(!T)return void v.reject({type:"login_error",error:"captcha"});const{captcha_sid:r,captcha_img:s,captcha_type:o,captcha_height:i,captcha_width:c,captcha_ts:u,captcha_attempt:l,is_refresh_enabled:h,is_sound_captcha_available:p,captcha_track:S,is_enabled_vkui:g,uiux_changes:m,redirect_uri:f}=a;b=!0;try{const a=await T({captcha_sid:r,captcha_img:s,captcha_type:o,captcha_height:i,captcha_width:c,is_refresh_enabled:h,is_sound_captcha_available:p,captcha_track:S,is_enabled_vkui:g,uiux_changes:m,redirect_uri:f}),A={captcha_ts:u,captcha_attempt:l},E=Object.assign({},e,a,A);O.delete(_),(async()=>{try{const e=await R(t,E,n);v.resolve(e)}catch(t){v.reject(t)}finally{b&&(b=!1,null==d.onCaptchaSuccess||d.onCaptchaSuccess.call(d))}})()}catch(t){O.delete(_),v.reject({type:"login_error",error:"captcha"})}return}const h=a.data.expires||1/0;d.disableSaveToken||o.setItemToStorage(l,JSON.stringify({...a.data,expires:h})),o.removeItemFromStorage(_),I.set(_,!0),O.delete(_),v.resolve(a.data)}catch(t){E.delete(_),O.delete(_),v.reject({type:"network_error",error:t})}})(),v.get()}function y(t,e){if(!t)return void Object.keys(localStorage).forEach((t=>{c.test(t)&&o.removeItemFromStorage(t)}));let n=w;e&&(n=Object.assign({},w,e));const r=`${n.appId}:${t}:login:auth`;o.removeItemFromStorage(r)}},33740:function(t,e,n){n.d(e,{corsRequest:function(){return a},makeParams:function(){return o},toFormData:function(){return i}});var r=n(85637);const s=[r.CUA_STATE_PARAM,r.CUA_SESSION_PARAM];function o(t){return Object.keys(t).map((e=>{let n=t[e];return e=encodeURIComponent(e||""),n=encodeURIComponent(void 0===n?"":n),s.includes(e)&&!n?null:`${e}=${n}`})).filter(Boolean).join("&")}function i(t){const e=new FormData;for(const n in t)t.hasOwnProperty(n)&&("string"==typeof t[n]?e.append(n,t[n]):e.append(n,JSON.stringify(t[n])));return e}function a(t,e,n={}){const r=o(e);return fetch(t,{method:"POST",body:r,mode:"cors",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded"},...n})}},95748:function(t,e,n){n.d(e,{ONE_MINUTE_MS:function(){return r},getRandomWaitTime:function(){return s},waitTimeExp:function(){return o}});const r=6e4,s=(t=500,e=1500)=>window.FORCED_API_WAIT_TIME?window.FORCED_API_WAIT_TIME:~~(Math.random()*(e-t+1)+t),o=t=>{return 0===t?Promise.resolve():(e=(t=>{if(0===t)return 0;if(window.FORCED_API_WAIT_TIME)return window.FORCED_API_WAIT_TIME;const e=Math.random(),n=100*Math.pow(2,t)/2;return n+n*e})(t),new Promise((t=>{setTimeout((()=>t()),e)})));var e}},64830:function(t,e,n){n.d(e,{makeSharedState:function(){return a}});const r="__SHARED_STATE_KEY";"undefined"!=typeof self&&(()=>{const t=self.hasOwnProperty(r)?self[r]:Object.create(null);Object.defineProperty(self,r,{configurable:!0,value:t})})();const s=()=>self[r],o=t=>s()[t],i=(t,e)=>{s()[t]=e};function a(t,e,n){if("undefined"==typeof self){const t=e();return()=>t}const r=function(t,e){let n=t.replace(/[^a-zA-Z0-9-]/gi,"_").toLowerCase();0!==e&&(n+=`__${e}`);return n}(t,n.version);return r in s()||i(r,e()),()=>o(r)}},40239:function(t,e,n){n.d(e,{Ranges:function(){return c}});const r=1e8,s=5e16,o=2**56-1,i=2000000001,a=Object.freeze({MIN_CHAT_ID:0,MAX_CHAT_ID:r,UNAUTH_LONG_ID_SUBRANGE_WITH_DEVICE_ID_SIZE:s,UNAUTH_LONG_ID_SUBRANGE_WITHOUT_DEVICE_ID_SIZE:o,UNAUTH_LONG_ID_MIN:9e18,UNAUTH_LONG_ID_MAX:0x7e980f0d11490000,MARUSYA_UPLOAD_OWNER_MIN:593139650,MARUSYA_UPLOAD_OWNER_MAX:593139654,UNAUTH_LONG_ID_MIN_OLD:10000000001,UNAUTH_LONG_ID_MAX_OLD:11e10,FAKE_DOC_OWNER_MIN:2e9,FAKE_DOC_OWNER_MAX:2000063999,ADS_VIDEO_OWNER_MIN:16e6,ADS_VIDEO_OWNER_MAX:16000599,ADS_PHOTO_OWNER_MIN:1698e4,ADS_PHOTO_OWNER_MAX:16999999,AUDIO_FAKE_UMA_RELEASE_OWNER_MIN:-2002e6,AUDIO_FAKE_UMA_RELEASE_OWNER_MAX:-2001e6,AUDIO_FAKE_UMA_ALBUM_OWNER_MIN:-2000999999,AUDIO_FAKE_UMA_ALBUM_OWNER_MAX:-2e9,AUDIO_FAKE_UMA_OWNERS_COUNT:1e6,AUDIO_FAKE_WALL_OWNER_MIN:2e9,AUDIO_FAKE_WALL_OWNER_MAX:2000512e3,USERS_LOWER_BOUND:1,USERS_UPPER_BOUND:19e8,USERS_LOWER_BOUND_LONG:2e11,USERS_UPPER_BOUND_LONG:1e12,EMAIL_UPPER_BOUND:-2e9,CONTACTS_LOWER_BOUND:1900000001,CONTACTS_UPPER_BOUND:2e9,CALLS_PEER_LOWER_BOUND:-1899999999,CALLS_PEER_UPPER_BOUND:-189e7,ANONYMOUS_USER_PEER_ID_LOWER_BOUND:10000000001,ANONYMOUS_USER_PEER_ID_UPPER_BOUND:11e10,CHAT_OR_CHANNEL_LOWER_BOUND:i,CHAT_OR_CHANNEL_UPPER_BOUND:21e8,GROUPS_LOWER_BOUND:-1e9,GROUPS_UPPER_BOUND:-1,APP_LOWER_BOUND:-1999999999,APP_UPPER_BOUND:-1e9,ALIEXPRESS_USER_ID_RANGE_START:2e9,ALIEXPRESS_USER_ID_RANGE_LENGTH:150,AD_BOT_ID_RANGE_START:2e9,AD_BOT_ID_RANGE_END:2000064e3,MARUSIA_AUDIO_FAKE_ID_MIN:2000512001,MARUSIA_AUDIO_FAKE_ID_MAX:2000512051,AUTOTEST_GROUP_ID_MIN:216720807,AUTOTEST_GROUP_ID_MAX:216820807,EXTERNAL_USER_ID_OFFSET:-19e8,APP_DOMAIN_ID_OFFSET:-1e9}),c=Object.freeze({getAutotestGroupIdRand:()=>l(a.AUTOTEST_GROUP_ID_MIN,a.AUTOTEST_GROUP_ID_MAX),isAutotestGroup:t=>t>=a.AUTOTEST_GROUP_ID_MIN&&t<=a.AUTOTEST_GROUP_ID_MAX,isGroupId:t=>t<=a.GROUPS_UPPER_BOUND&&t>a.GROUPS_LOWER_BOUND,isUserId:t=>t>=a.USERS_LOWER_BOUND&&t<a.USERS_UPPER_BOUND||t>=a.USERS_LOWER_BOUND_LONG&&t<a.USERS_UPPER_BOUND_LONG,isUserIdTransitional(t){c.isUserId(t);const e=u(t,0,a.CONTACTS_UPPER_BOUND);return e},isRealOwner:t=>c.isGroupId(t)||c.isUserId(t),isAudioOwner:t=>c.isRealOwner(t)||c.isUMA(t)||c.isFakeWallAudioOwner(t),isPlaylistOwner:t=>c.isRealOwner(t)||c.isUMA(t)||c.isChatOrChannelPeer(t),isOfficialPlaylist:t=>c.isUMAReleaseOwner(t)||c.isUMAAlbumOwner(t),isFakeWallAudioOwner:t=>d(t,a.AUDIO_FAKE_WALL_OWNER_MIN,a.AUDIO_FAKE_WALL_OWNER_MAX),isUMA:t=>c.isUMAReleaseOwner(t)||c.isUMAAlbumOwner(t),isUMAAlbumOwner:t=>d(t,a.AUDIO_FAKE_UMA_ALBUM_OWNER_MIN,a.AUDIO_FAKE_UMA_ALBUM_OWNER_MAX),getUMAAlbumOwnerByShift:t=>a.AUDIO_FAKE_UMA_ALBUM_OWNER_MAX-Math.abs(t%a.AUDIO_FAKE_UMA_OWNERS_COUNT),isUMAReleaseOwner:t=>d(t,a.AUDIO_FAKE_UMA_RELEASE_OWNER_MIN,a.AUDIO_FAKE_UMA_RELEASE_OWNER_MAX),getUMAReleaseOwnerByShift:t=>a.AUDIO_FAKE_UMA_RELEASE_OWNER_MAX-Math.abs(t%a.AUDIO_FAKE_UMA_OWNERS_COUNT),isEmailId:t=>t<a.EMAIL_UPPER_BOUND,isOwnerId:t=>t>=a.USERS_LOWER_BOUND?c.isUserId(t):c.isGroupId(t),isContactId:t=>t>=a.CONTACTS_LOWER_BOUND&&t<a.CONTACTS_UPPER_BOUND,convertContactIdToPeerId:t=>t+a.USERS_UPPER_BOUND,convertPeerIdToContactId:t=>t-a.USERS_UPPER_BOUND,isChatOrChannelPeer:t=>t>=a.CHAT_OR_CHANNEL_LOWER_BOUND&&t<=a.CHAT_OR_CHANNEL_UPPER_BOUND,isChatId:t=>t>a.MIN_CHAT_ID&&t<=a.MAX_CHAT_ID,convertChatPeerIdToChatId:t=>t-a.CONTACTS_UPPER_BOUND,convertChatIdToChatPeerId:t=>t+a.CONTACTS_UPPER_BOUND,isAppDomain:t=>t>=a.APP_LOWER_BOUND&&t<a.APP_UPPER_BOUND,convertPeerIdToAppId:t=>-t+a.APP_UPPER_BOUND,convertAppIdToPeerId:t=>a.APP_UPPER_BOUND-t,isUnauthLongId:t=>d(t,a.UNAUTH_LONG_ID_MIN,a.UNAUTH_LONG_ID_MAX),isUnauthLongIdOld:t=>d(t,a.UNAUTH_LONG_ID_MIN_OLD,a.UNAUTH_LONG_ID_MAX_OLD),isMarusyaUploadOwner:t=>a.MARUSYA_UPLOAD_OWNER_MIN<=t&&t<=a.MARUSYA_UPLOAD_OWNER_MAX,getRandomMarusyaUploadOwnerId:()=>l(a.MARUSYA_UPLOAD_OWNER_MIN,a.MARUSYA_UPLOAD_OWNER_MAX),isFakeDocOwner:t=>d(t,a.FAKE_DOC_OWNER_MIN,a.FAKE_DOC_OWNER_MAX),getFirstFakeOwnerId:()=>a.FAKE_DOC_OWNER_MIN,getRandomFirstFakeOwnerId:()=>l(a.FAKE_DOC_OWNER_MIN,a.FAKE_DOC_OWNER_MIN+64e3),getRandomFakeOwnerId:()=>a.FAKE_DOC_OWNER_MIN+(Math.floor(Date.now()/1e3)/173+l(0,999))%64e3,isAdsVideoOwner:t=>d(t,a.ADS_VIDEO_OWNER_MIN,a.ADS_VIDEO_OWNER_MAX),getRandomAdsVideoOwner:()=>l(a.ADS_VIDEO_OWNER_MIN,a.ADS_VIDEO_OWNER_MAX),isAdsPhotoOwner:t=>d(t,a.ADS_PHOTO_OWNER_MIN,a.ADS_PHOTO_OWNER_MAX),getRandomAdsPhotoOwner:()=>l(a.ADS_PHOTO_OWNER_MIN,a.ADS_PHOTO_OWNER_MAX),isZeroOwner:t=>0===t,convertEmailIdToEmailPeerId:t=>c.isEmailId(t)?-t+a.EMAIL_UPPER_BOUND:0,isZeroOwnerDeprecated:t=>!!t||c.isZeroOwner(t),isExternalUser:t=>u(t,a.EMAIL_UPPER_BOUND,a.EXTERNAL_USER_ID_OFFSET),isExternalUserDeprecated(t){c.isExternalUser(t);const e=u(t,a.EMAIL_UPPER_BOUND,a.APP_DOMAIN_ID_OFFSET);return e},isAnonymousCallPeerId:t=>t>=a.CALLS_PEER_LOWER_BOUND&&t<a.CALLS_PEER_UPPER_BOUND,isAnonymousUserPeerId:t=>t>=a.ANONYMOUS_USER_PEER_ID_LOWER_BOUND&&t<a.ANONYMOUS_USER_PEER_ID_UPPER_BOUND,getAnonymousCallUserByShift(t){const e=a.CALLS_PEER_UPPER_BOUND-a.CALLS_PEER_LOWER_BOUND,n=(t%e+e)%e;return a.CALLS_PEER_UPPER_BOUND-1-n},isValidAliExpressOrderUserId:t=>!(t<a.ALIEXPRESS_USER_ID_RANGE_START)&&!(t>a.ALIEXPRESS_USER_ID_RANGE_START+a.ALIEXPRESS_USER_ID_RANGE_LENGTH),generateAliexpressOrderUserId:()=>l(a.ALIEXPRESS_USER_ID_RANGE_START,a.ALIEXPRESS_USER_ID_RANGE_LENGTH),isADBot:t=>t>=a.AD_BOT_ID_RANGE_START&&t<=a.AD_BOT_ID_RANGE_END,getMarusiaAudioFakeId(t){const e=a.MARUSIA_AUDIO_FAKE_ID_MAX-a.MARUSIA_AUDIO_FAKE_ID_MIN;return a.MARUSIA_AUDIO_FAKE_ID_MIN+t%e},isMarusiaAudioFakeId:t=>t>=a.MARUSIA_AUDIO_FAKE_ID_MIN&&t<a.MARUSIA_AUDIO_FAKE_ID_MAX,isOwnerIdTransitional:t=>t>a.USERS_LOWER_BOUND?c.isUserIdTransitional(t):c.isGroupId(t),convertGroupIdToOwnerId:t=>-t,convertGroupIdToOwnerIdStrict:t=>-Math.abs(t),convertOwnerIdToGroupId:t=>Math.abs(t)});function u(t,e,n){return e<t&&t<n}function d(t,e,n){return e<=t&&t<=n}function l(t,e){return t+Math.floor(Math.random()*(e-t))}},59197:function(t,e,n){n.d(e,{WebStats:function(){return _}});var r=n(79377);class s{logWebStatsEvent(t,e){var n;(null==(n=this.options)?void 0:n.isDebuggerMode)&&console.log(`[new transport debug] ${t}`,e)}constructor({options:t}){this.options=t}}var o=n(51479),i=n(57547);class a{writeLocked(t){if("locked"!==this.sessionStorage.getItem(this.lockName)){this.debug.logWebStatsEvent("writeLocked","lock"),this.sessionStorage.setItem(this.lockName,"locked");try{t()}catch(t){}return this.debug.logWebStatsEvent("writeLocked","free"),void this.sessionStorage.setItem(this.lockName,"free")}setTimeout((()=>this.writeLocked(t)),100)}getWebStatDataLs(){return this.localStorage.getItem(this.lsDataKey)||i.emptyStatsDataLs}serializeDataToLs(t){return this.localStorage.setItem(this.lsDataKey,JSON.stringify(t))}getWebStatsStringValue(t,e=this.getWebStatDataLs()){var n;const r=Object.keys((0,i.getEmptyStatsData)()).filter((e=>e!==t)).join("|"),s=(null==e||null==(n=e.match(new RegExp(`"${t}":(\\[.*?\\])(?:,"(${r})":\\[|}$)`)))?void 0:n[1])||"";return(0,i.isArrayLike)(s)?s:"[]"}fetchDataFromLs(){let t,e=!0;try{const n=this.getWebStatDataLs();if(!n)throw new Error("empty data");t=(0,i.getEmptyStatsData)();const r=JSON.parse(n);Object.keys(t).forEach((n=>{Array.isArray(r[n])&&(e=!1,t[n]=r[n])}))}catch(e){t=(0,i.getEmptyStatsData)()}return{webStatsData:t,isEmpty:e}}clearLsData(t){t&&this.debug.logWebStatsEvent("WebStats cleared. "+(t?"Reason: LS is broken.":""),t),this.writeLocked((()=>this.localStorage.setItem(this.lsDataKey,"")))}setLastSendTime(t=Number(new Date)){this.sessionStorage.setItem(this.lsMetaKey,t.toString())}getLastSendTime(){return parseInt(`${this.sessionStorage.getItem(this.lsMetaKey)||0}`)}getWebStatsItemsCount(t){return Object.values(t).reduce(((t,e)=>t+=e.length),0)}pullFromWebStats(t,e){const n=this.getWebStatsStringValue(t,e);if("[]"!==n){const t=this.getWebStatDataLs().replace(n.slice(1,-1),"").replace(/\[\,/,"[");this.writeLocked((()=>this.localStorage.setItem(this.lsDataKey,t)))}}constructor({statsMeta:t,debug:e,localStorage:n,sessionStorage:r}){this.lsDataKey=`XHR_STATS_TRANSPORT_DATA_${t.platform}`,this.lsMetaKey=`XHR_STATS_TRANSPORT_META_${t.platform}`,this.lockName=`XHR_STATS_TRANSPORT_DATA_LOCK_${t.platform}`,this.debug=e,this.localStorage=n||o.localStorage,this.sessionStorage=r||o.sessionStorage}}class c{batchStaleWebStats(t,e){const[n,r]=e,s=`{"${n}":[${JSON.parse(r).reduce(((e,n,r)=>e.length<this.maxBodyChunkSize-t.length?`${e}${0===r?"":","}${JSON.stringify(n)}`:e),"")}]}`;return"{}"===t?s:(0,i.concatJSONS)(t,s)||t}getMaximumWebStats(t){const e=Date.now(),n=t=>`{${null==t?void 0:t.map((([t,e])=>`"${t}":${e}`)).join(",")}}`,[s,o]=Object.keys((0,i.getEmptyStatsData)()).reduce(((e,n)=>{const r=this.webStatsStorage.getWebStatsStringValue(n,t);return"[]"===r?e:[...e,[n,r]]}),[]).sort((([,t],[,e])=>e.length-t.length)).reduce((([t,e],[r,s])=>{const o=[[r,s]];return s.length+n(t).length<this.maxBodyChunkSize?[t.concat(o),e]:[t,e.concat(o)]}),[[],[]]),a=n(s);if((0,i.logProcessingTime)(Date.now()-e,"chunk",this.statsMeta,this.statlogsValueEvent),Date.now()-e<r.PROCESSING_LIMIT&&o[0]&&a.length<.1*this.maxBodyChunkSize){const t=Date.now();try{const e=this.batchStaleWebStats(a,o.reverse()[0]);return(0,i.logProcessingTime)(Date.now()-t,"batch",this.statsMeta,this.statlogsValueEvent),e}catch(e){return(0,i.logProcessingTime)(Date.now()-t,"batch-fail",this.statsMeta,this.statlogsValueEvent),""}}return a}constructor({statsMeta:t,statlogsValueEvent:e,webStatsStorage:n,maxBodyChunkSize:r}){this.statsMeta=t,this.statlogsValueEvent=e,this.webStatsStorage=n,this.maxBodyChunkSize=r}}var u=n(21505);class d{isBatchBoostRequired(){const t=this.statsMeta.started||Date.now();return Date.now()-t<=r.BOOST_DURATION}debounceMs(){return this.isBatchBoostRequired()?r.BOOST_DEBOUNCE_MS:r.DEBOUNCE_MS}limitMs(){return this.isBatchBoostRequired()?r.BOOST_DEBOUNCE_LIMIT_MS:r.DEBOUNCE_LIMIT_MS}cooldownMs(){return this.isBatchBoostRequired()?r.BOOST_COOLDOWN_MS:r.COOLDOWN_MS}penaltyMs(){return this.debounceMs()*this.sendAttempt**.5}onCooldown(){return!(Date.now()-this.webStatsStorage.getLastSendTime()>this.cooldownMs()+this.penaltyMs())}tillCooldownMs(){return Math.max(0,this.webStatsStorage.getLastSendTime()+this.cooldownMs()-Date.now()+this.penaltyMs())}tillLimitMs(){return Math.max(0,this.webStatsStorage.getLastSendTime()+this.limitMs()-Date.now())}checkWebStatsLater(){var t;this.isSendingWebStats||this.timeoutID||(this.timeoutID=null==(t=(0,i.getWindow)())?void 0:t.setTimeout((()=>{const t=this.webStatsStorage.getWebStatDataLs();this.timeoutID=void 0,t.length>i.emptyStatsDataLs.length&&this.saveAndSendStats(t)}),Math.max(Math.min(this.tillLimitMs(),this.debounceMs()),this.tillCooldownMs())))}sendStatsWithBatching(t){const e=t.length>this.maxBodyChunkSize;let n=e?this.batchers.getMaximumWebStats(t):t,r=!1;if(!n)return this.isSendingWebStats=!1,this.webStatsStorage.clearLsData();n=(0,i.appendStatsMeta)(++this.sendAttempt,n,this.statsMeta),this.sendStats(n,(s=>{const o=Date.now();this.isSendingWebStats=!1,s<500&&(e&&200===s?Object.keys((0,i.getEmptyStatsData)()).forEach((t=>this.webStatsStorage.pullFromWebStats(t,n))):this.webStatsStorage.clearLsData(),this.sendAttempt=0,r=!0),(e||400===s)&&(0,i.logProcessingTime)(Date.now()-o,`${e?"prune":"clean"}${400===s?"-fail":""}`,this.statsMeta,this.statlogsValueEvent,`${t.length>>>20}M ${n.length>>>20}M`),this.checkWebStatsLater()}),(()=>{this.isSendingWebStats=!1,!r&&this.webStatsStorage.clearLsData()}))}idlizeCall(t,e){var n;const r=e=>setTimeout((()=>t()),e);return(null==e?void 0:e.force)?r(0):(null==(n=(0,i.getWindow)())?void 0:n.requestIdleCallback)?window.requestIdleCallback((()=>r(this.debounceMs())),{timeout:this.debounceMs()/2}):r(this.debounceMs())}async sendStats(t,e,n){const r=new URLSearchParams,s=await this.getBrowserFingerprint();s&&r.set("device_id",s);const o=r.toString(),a=this.generateReservedUrl();let c=this.createUrl(this.statsMeta,o);const u=(t,r)=>{if(r)return void this.sendApi(t,e,n,r);const s=new XMLHttpRequest;s.withCredentials=c.includes(`tau.${this.hostName}`),s.onreadystatechange=()=>{s.readyState===XMLHttpRequest.DONE&&e(s.status)},s.onerror=this.options.useReservedUrls?()=>{this.reportedUrls.has(c)||(this.reportedUrls.add(c),null==this.statlogsValueEvent||this.statlogsValueEvent.call(this,"web_stats_request_error",1,c.split("?")[0],this.hasAdblock,s.status));const{value:e,done:o}=a.next();o?n():(c=e,u(t,r))}:n,s.open("POST",c,!0),s.setRequestHeader("Content-Type","application/json;charset=UTF-8"),s.send(t)},[d,l]=await Promise.all([(0,i.getApiConfig)(this.apiParams),this.checkAdblock(this.statsMeta.wsTransport)]);if((0,i.canSendBeacon)(this.hostName,this.statsMeta)&&!l)try{await(0,i.sendBeacon)(c,t,d),e(200)}catch(e){u(t,d)}else u(t,d)}sendStat(t,e,n){t=(0,i.appendStatsMeta)(1,t,this.statsMeta),this.sendStats(t,e,n)}saveAndSendStats(t,e){var n;return(null==(n=this.options)?void 0:n.isNewQueue)?this.saveAndSendStatsNew(t,e):this.saveAndSendStatsOld(t,e)}saveAndSendStatsOld(t,e){const n=t.length>=this.maxBodyChunkSize,r=(null==e?void 0:e.force)||n;if(t.length<=i.emptyStatsDataLs.length)this.debug.logWebStatsEvent("WebStats empty data.","");else{if(!this.isSendingWebStats)return r||this.timeoutID||!this.onCooldown()?(this.isSendingWebStats=!0,this.idlizeCall((()=>{const t=this.webStatsStorage.getWebStatDataLs();if(t.length>i.emptyStatsDataLs.length&&(r||!this.onCooldown()))return this.webStatsStorage.setLastSendTime(),this.sendStatsWithBatching(t);clearTimeout(this.timeoutID),this.isSendingWebStats=!1,this.timeoutID=void 0}),{...e,force:r})):(this.debug.logWebStatsEvent("WebStats delayed.",this.timeoutID),this.checkWebStatsLater());this.debug.logWebStatsEvent("WebStats sending.",this.isSendingWebStats)}}saveAndSendStatsNew(t,e){const n=t.length>=this.maxBodyChunkSize,r=(null==e?void 0:e.force)||n;if(t.length<=i.emptyStatsDataLs.length)this.debug.logWebStatsEvent("WebStats empty data.","");else{if(!this.isSendingWebStats)return!r&&this.onCooldown()?(this.checkWebStatsLater(),void this.debug.logWebStatsEvent("WebStats delayed.",this.timeoutID)):(this.isSendingWebStats=!0,this.idlizeCall((()=>{const t=this.webStatsStorage.getWebStatDataLs();if(t.length>i.emptyStatsDataLs.length&&(!this.onCooldown()||r))return clearTimeout(this.timeoutID),this.timeoutID=void 0,this.webStatsStorage.setLastSendTime(),this.sendStatsWithBatching(t);this.isSendingWebStats=!1}),{...e,force:r}));this.debug.logWebStatsEvent("WebStats sending.",this.isSendingWebStats)}}async checkAdblock(t){if(!this.options.useReservedUrls)return!1;if(void 0!==this.hasAdblock)return this.hasAdblock;try{await fetch(t,{method:"GET",mode:"no-cors"}),this.hasAdblock=!1}catch(t){this.hasAdblock=!0}return this.hasAdblock}constructor({options:t,statsMeta:e,hostName:n,debug:r,statlogsValueEvent:s,getBrowserFingerprint:o,batchers:a,webStatsStorage:c,maxBodyChunkSize:d,apiParams:l,createUrl:_,generateReservedUrl:h}){this.sendAttempt=0,this.isSendingWebStats=!1,this.reportedUrls=new Set,this.sendApi=async(t,e,n,r)=>{try{const n=JSON.stringify((0,i.transformEventsToArray)(t));await(0,u.api)(r.method,{events:n,...r.body},r.overrideApiConfig),e(200)}catch(t){n()}},this.options=t,this.statsMeta=e,this.hostName=n,this.debug=r,this.statlogsValueEvent=s,this.getBrowserFingerprint=o,this.batchers=a,this.webStatsStorage=c,this.maxBodyChunkSize=d,this.apiParams=l,this.createUrl=_,this.generateReservedUrl=null!=h?h:function*(){}}}class l{pushToWebStats(t,e){const n=this.webStatsStorage.getWebStatsStringValue(t);return this.webStatsStorage.getWebStatDataLs().replace(`"${t}":${n}`,`"${t}":${n.replace(/]$/,`${"[]"===n?"":","}${JSON.stringify(e)}]`)}`)}transformStatlogEvent({name:t,value:e,keys:n=[]}){var r;const s=[Math.round(Number(Date.now())/1e3),t,e,...n];return(null==(r=this.options)?void 0:r.isDebuggerMode)&&console.log("Data was transformed!"),s}sendWebStats(t,e){t===r.Stats.StatlogEvents&&(e=this.transformStatlogEvent(e));const n=(0,i.getEmptyStatsData)();n[t]=[e];const s=JSON.stringify(n);return new Promise(((t,n)=>{this.webStatsBatchedTransport.sendStat(s,(()=>t()),n),this.debug.logWebStatsEvent("sendWebStatsEvent",e)}))}writeAndSendWebStats(t,e,n,r){const s=this.pushToWebStats(e,n);this.webStatsStorage.writeLocked((()=>{this.localStorage.setItem(this.webStatsStorage.lsDataKey,s),this.webStatsBatchedTransport.saveAndSendStats(s,r)})),this.debug.logWebStatsEvent(t,n)}saveStatlogEvents(t){const e=this.transformStatlogEvent(t);return this.writeAndSendWebStats("saveStatlogEvents",r.Stats.StatlogEvents,e)}saveNetworkStats(t){return this.writeAndSendWebStats("saveNetworkStats",r.Stats.NetworkStats,t)}saveStoryViewBaseStats(t){return this.writeAndSendWebStats("saveStoryViewStats",r.Stats.StoryViewStats,t)}saveStoryViewStats(t){return this.saveStoryViewBaseStats(t)}saveWebPerfStats(t){return this.writeAndSendWebStats("saveWebPerfStats",r.Stats.WebPerfStats,t)}saveBenchmarkMainStats(t){return this.writeAndSendWebStats("saveBenchmarkMainStats",r.Stats.BenchmarkMainStats,t)}saveVkResStats(t){return this.writeAndSendWebStats("saveVkResStats",r.Stats.VkResStats,[...t.details])}constructor({webStatsStorage:t,debug:e,options:n,localStorage:s,webStatsBatchedTransport:i}){this.saveProductionStats=(t,e)=>this.writeAndSendWebStats("saveProductionStats",r.Stats.ProductionStats,t,e),this.saveCustomStats=t=>this.writeAndSendWebStats("saveCustomStats",r.Stats.CustomStats,t),this.webStatsStorage=t,this.debug=e,this.options=n,this.localStorage=s||o.localStorage,this.webStatsBatchedTransport=i}}class _{sendWebStats(t,e){return this.api.sendWebStats(t,e)}writeAndSendWebStats(t,e,n,r){return this.api.writeAndSendWebStats(t,e,n,r)}saveStatlogEvents(t){return this.api.saveStatlogEvents(t)}saveProductionStats(t,e){return this.api.saveProductionStats(t,e)}saveNetworkStats(t){return this.api.saveNetworkStats(t)}saveStoryViewBaseStats(t){return this.api.saveStoryViewBaseStats(t)}saveStoryViewStats(t){return this.api.saveStoryViewStats(t)}saveWebPerfStats(t){return this.api.saveWebPerfStats(t)}saveBenchmarkMainStats(t){return this.api.saveBenchmarkMainStats(t)}saveVkResStats(t){return this.api.saveVkResStats(t)}constructor({options:t,statsMeta:e,hostName:n,statlogsValueEvent:o,getBrowserFingerprint:i,generateReservedUrl:u,sessionStorage:_,localStorage:h,smallerChunks:p,apiParams:S,createUrl:g}){this.saveCustomStats=t=>this.api.saveCustomStats(t),this.debug=new s({options:t}),this.webStatsStorage=new a({statsMeta:e,debug:this.debug,sessionStorage:_,localStorage:h}),this.maxBodyChunkSize=p?r.MAX_BODY_SIZE_SMALL_CHUNK:r.MAX_BODY_SIZE_NORMAL_CHUNK,this.batchers=new c({statsMeta:e,statlogsValueEvent:o,webStatsStorage:this.webStatsStorage,maxBodyChunkSize:this.maxBodyChunkSize}),this.batchedWebStatsTransport=new d({options:t,statsMeta:e,hostName:n,debug:this.debug,statlogsValueEvent:o,getBrowserFingerprint:i,batchers:this.batchers,webStatsStorage:this.webStatsStorage,maxBodyChunkSize:this.maxBodyChunkSize,apiParams:S,createUrl:g,generateReservedUrl:u}),this.api=new l({webStatsStorage:this.webStatsStorage,debug:this.debug,webStatsBatchedTransport:this.batchedWebStatsTransport,options:t,localStorage:h})}}},79377:function(t,e,n){n.d(e,{AVAILABLE_STATS:function(){return p},BOOST_COOLDOWN_MS:function(){return c},BOOST_DEBOUNCE_LIMIT_MS:function(){return a},BOOST_DEBOUNCE_MS:function(){return i},BOOST_DURATION:function(){return d},COOLDOWN_MS:function(){return o},DEBOUNCE_LIMIT_MS:function(){return s},DEBOUNCE_MS:function(){return r},MAX_BODY_SIZE_NORMAL_CHUNK:function(){return _},MAX_BODY_SIZE_SMALL_CHUNK:function(){return l},PROCESSING_LIMIT:function(){return u},Stats:function(){return h}});const r=1e4,s=2e4,o=2e4,i=1e3,a=2e3,c=5e3,u=500,d=3e4,l=.5*Math.pow(10,6),_=1.8*Math.pow(10,6),h={BenchmarkMainStats:"benchmarkMainStats",CustomStats:"customStats",NetworkStats:"networkStats",ProductionStats:"productionStats",StatlogEvents:"statlogEvents",StoryViewStats:"storyViewStats",WebPerfStats:"webPerfStats",VkResStats:"vkResStats"},p=[h.BenchmarkMainStats,h.CustomStats,h.NetworkStats,h.ProductionStats,h.StatlogEvents,h.StoryViewStats,h.WebPerfStats,h.VkResStats]},51479:function(t,e,n){n.d(e,{CustomStorage:function(){return s},localStorage:function(){return l},sessionStorage:function(){return p}});var r=n(57547);class s{setItem(t,e){this.data[t]=String(e)}getItem(t){return this.data.hasOwnProperty(t)?this.data[t]:null}removeItem(t){delete this.data[t]}clear(){this.data={}}get length(){return Object.keys(this.data).length}key(t){return Object.keys(this.data)[t]}constructor(){this.data={},this.keys=()=>Object.keys(this.data)}}const o="vk-ls-dummy",i=Math.random().toString(),a={localStorage:null,sessionStorage:null};function c(t){if(null===a[t])try{var e;const n=null==(e=(0,r.getWindow)())?void 0:e[t];null==n||n.setItem(o,i),a[t]=i===(null==n?void 0:n.getItem(o)),null==n||n.removeItem(o)}catch(e){a[t]=!1}return a[t]}let u;function d(){return u||(u=c("localStorage")?window.localStorage:new s,u)}const l={setItem:(t,e)=>d().setItem(t,e),getItem:t=>d().getItem(t),removeItem:t=>d().removeItem(t),clear:()=>d().clear(),get length(){return d().length},key:t=>d().key(t),keys(){const t=d();return t instanceof s?t.keys():Object.keys(t)},getPrefixedKeys:t=>l.keys().filter((e=>e.startsWith(t)))};let _;function h(){return _||(_=c("sessionStorage")?window.sessionStorage:new s,_)}const p={setItem:(t,e)=>h().setItem(t,e),getItem:t=>h().getItem(t),removeItem:t=>h().removeItem(t),clear:()=>h().clear(),get length(){return h().length},key:t=>h().key(t),keys(){const t=h();return t instanceof s?t.keys():Object.keys(t)},getPrefixedKeys:t=>p.keys().filter((e=>e.startsWith(t)))}},57547:function(t,e,n){n.d(e,{appendStatsMeta:function(){return d},canSendBeacon:function(){return l},concatJSONS:function(){return a},emptyStatsDataLs:function(){return p},getApiConfig:function(){return g},getEmptyStatsData:function(){return h},getWindow:function(){return S},isArrayLike:function(){return i},logProcessingTime:function(){return _},sendBeacon:function(){return u},transformEventsToArray:function(){return c}});var r=n(27145),s=n(79377);const o=t=>t.startsWith("{")&&t.endsWith("}"),i=t=>t.startsWith("[")&&t.endsWith("]"),a=(t,e)=>[t,e].every(o)?`${t.slice(0,-1)},${e.substring(1)}`:"{}",c=t=>{try{const e=JSON.parse(t),n=Object.entries(e),r=[];return n.forEach((t=>{const[e,n]=t;s.AVAILABLE_STATS.includes(e)&&Array.isArray(n)&&r.push(...n)})),r}catch(t){return[]}};function u(t,e,n){try{if(!(n?(0,r.apiBeacon)(n.method,{events:c(e),...n.body},n.overrideApiConfig):navigator.sendBeacon(t,e)))return Promise.reject(new Error("Beacon not sent"))}catch(t){return Promise.reject(new Error("Beacon fail"))}return Promise.resolve()}const d=(t,e,n)=>{const{userId:r,st:s,platform:i,appId:c,time:u,hash:d,itemId:l,itemOwnerId:_,itemType:h}=n;return a(JSON.stringify({id:r,st:s,platform:i,appId:c,attempt:t,signTime:u,sign:d,...l&&{itemId:l},...h&&{itemType:h},..._&&{itemOwnerId:_}}),o(e)?e:"{}")};function l(t,e){return"sendBeacon"in navigator&&!e.wsTransport.includes(`tau.${t}`)}function _(t,e,n,r,s){null==r||r("web_stats_batching_time",t,n.platform,e,s)}const h=()=>({statlogEvents:[],productionStats:[],storyViewStats:[],networkStats:[],customStats:[],webPerfStats:[],benchmarkMainStats:[],vkResStats:[]}),p=JSON.stringify(h()),S=()=>"undefined"!=typeof window?window:void 0,g=async t=>{if(!t)return;const{additionalBody:e,method:n,domain:r,version:s,appId:o,getToken:i}=t;return{body:e,overrideApiConfig:{domain:r,version:s,appId:o,accessToken:await i()},method:n}}}}]);