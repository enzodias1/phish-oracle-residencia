"use strict";(globalThis.webpackChunkOwa=globalThis.webpackChunkOwa||[]).push([[71719],{535525:(e,t,r)=>{r.d(t,{H:()=>n});var n=(e=>(e.UserInteractionRequired="USER_INTERACTION_REQUIRED",e.UserCancel="USER_CANCEL",e.NoNetwork="NO_NETWORK",e.TransientError="TRANSIENT_ERROR",e.PersistentError="PERSISTENT_ERROR",e.Disabled="DISABLED",e.AccountUnavailable="ACCOUNT_UNAVAILABLE",e.NestedAppAuthUnavailable="NESTED_APP_AUTH_UNAVAILABLE",e))(n||{})},571719:(e,t,r)=>{r.d(t,{i4:()=>w,jO:()=>v,Uw:()=>N});var n=r(167594),s=r(719363),o=r(161552),i=r(611143);function a(e){return void 0!==e.status}function d(e){return(0,s.G7)("auth-naa-prefetch")&&[o.H].includes(e.clientId)}function c(e,t){return[t,e.clientId,e.scope,e.claims].join("|")}function u(e,t){return{messageType:"NestedAppAuthResponse",requestId:e,success:!1,error:t}}var p=r(535525),l=r(881384);function h(e,t,r={}){return(0,l.A)(p.H.PersistentError,"unexpected_bridge_error",e,t,r)}async function A(e,t){try{let r=await t;if(!r.token&&!r.initContext)throw h("invalid_response","The bridge response did not contain a token or initContext");return{messageType:"NestedAppAuthResponse",requestId:e,success:!0,...r}}catch(t){return u(e,t&&a(t)?t:h("unknown_error",String(t)))}}async function f(e,t,r,n,s,o,a){let{host:d,protocol:c}=new URL(r);if("https:"!==c||!d)throw Error("Invalid origin");let p=JSON.parse(e);if("object"!=typeof p||null===p||!(void 0!==p.messageType&&"NestedAppAuthRequest"===p.messageType&&void 0!==p.method&&void 0!==p.requestId))throw Error("Invalid request payload");let l=await function(e,t,r,n,s){switch(e.method){case"GetToken":if(e.tokenParams)return A(e.requestId,t.getTokenRequest(e.tokenParams,r));break;case"GetTokenPopup":if(e.tokenParams)return A(e.requestId,t.getTokenPopup(e.tokenParams,r,s));break;case"GetInitContext":return A(e.requestId,t.getInitContext(n).then(e=>({initContext:e})))}return Promise.resolve(u(e.requestId,h("unknown_request_method",`Unknown request method: ${e.method}`)))}(p,t,d,n,s);return(0,i.Xs)("NAARequest",{scenarioName:o,callerId:a,method:p.method,success:l.success,duration:p.sendTime?Date.now()-p.sendTime:void 0,expiresIn:l.token?.expires_in,status:l.error?.status,code:l.error?.code,subError:l.error?.subError,correlationId:p.tokenParams?.correlationId,isTrustedOrigin:n}),JSON.stringify(l)}let I=new Map;function m(e,t){var r;let s=(0,n.ku)(t),o=I.get(s);return o||(o=new(r=e,class extends r{constructor(){super(...arguments),this.prefetchedResponses=new Map}prefetchToken(e,t,r){if(!d(e))return;let n=c(e,t);if(!this.prefetchedResponses.get(n))try{let s={startedAt:Date.now(),responsePromise:super.getTokenRequest(e,t),requestHost:t,correlationId:e.correlationId,scenarioName:r};this.prefetchedResponses.set(n,s),s.responsePromise.then(t=>{if(this.prefetchedResponses.get(n)===s){let o=Date.now();if(s.completedAt=o,t.token.expires_in<=120){this.prefetchedResponses.delete(n),(0,i.Xs)("NAAPrefetchOutcome",{scenarioName:r,prefetchCorrelationId:e.correlationId,aborted:!0,timeInCache:Date.now()-s.startedAt,expiresIn:t.token.expires_in});return}let a=Math.min(3600,t.token.expires_in-120),d=setTimeout(()=>{this.prefetchedResponses.get(n)===s&&(this.prefetchedResponses.delete(n),(0,i.Xs)("NAAPrefetchOutcome",{scenarioName:r,prefetchCorrelationId:e.correlationId,expired:!0,requestDuration:o-s.startedAt,timeInCache:Date.now()-s.startedAt,expiresIn:t.token.expires_in}))},1e3*a);s.clearTimeout=()=>clearTimeout(d)}}).catch(t=>{this.prefetchedResponses.get(n)===s&&(this.prefetchedResponses.delete(n),(0,i.Xs)("NAAPrefetchOutcome",{scenarioName:r,prefetchCorrelationId:e.correlationId,errored:!0,bridgeError:a(t)?t.status:void 0,timeInCache:Date.now()-s.startedAt}))})}catch{}}async getTokenRequest(e,t){if(d(e)){let r=c(e,t),n=this.prefetchedResponses.get(r);if(n){let t=n.responsePromise;n.clearTimeout?.(),this.prefetchedResponses.delete(r);let s={scenarioName:n.scenarioName,prefetchCorrelationId:n.correlationId,requestCorrelationId:e.correlationId,redeemed:!0,timeInCache:Date.now()-n.startedAt};if(void 0===n.completedAt)return(0,i.Xs)("NAAPrefetchOutcome",s),t;{let e=await t;return e.token.expires_in-=Math.ceil((Date.now()-n.completedAt)/1e3),(0,i.Xs)("NAAPrefetchOutcome",{...s,hasCompleted:!0,requestDuration:n.completedAt-n.startedAt,expiresIn:e.token.expires_in}),e}}}return super.getTokenRequest(e,t)}})(t),I.set(s,o)),o}function w(e,t,r,n,s,o,i,a){let d=m(e,t);if(d)return f(r,d,n,s,o,i,a);throw Error("Unable to get NestedAppAuthExecutor")}var R=r(570366);function N(e,t,r,n,s){let o=m(e,t);o&&o.prefetchToken({...r,correlationId:(0,R._)()},n,s)}var g=r(435156),k=r(429896),T=r(158888),E=r(830170),_=r(76226);function v(){let e;!(0,E.O)()&&(0,_.A)()&&(!window||window.nestedAppAuthBridge||((0,i.uZ)("InlineNAA_Bridge_Initialized"),window.nestedAppAuthBridge={addEventListener:(t,r)=>{(0,i.uZ)("InlineNAA_Bridge_AddEventListener",{eventName:t}),"message"===t&&r&&(e=r)},postMessage:t=>{if((0,i.uZ)("InlineNAA_Bridge_PostMessage"),t){let r=(0,g.zj)();if(!r?.executeNaaRequest)throw Error("Nested app auth is unavailable");r.executeNaaRequest((0,k.A)(),t,(0,T.$)(),!0,window,"InlineNestedAppAuthBridge","PRIVATE").then(t=>{e&&e(t)})}},removeEventListener:(t,r)=>{(0,i.uZ)("InlineNAA_Bridge_RemoveEventListener",{eventName:t}),"message"===t&&r===e&&(e=void 0)}}))}},881384:(e,t,r)=>{r.d(t,{A:()=>n});function n(e,t,r,s,o={}){return{status:e,code:t,subError:r,description:s,properties:o}}}}]),self.scriptsLoaded=self.scriptsLoaded||{},self.scriptsLoaded["owa.71719.m.5f82346a.js"]=1;